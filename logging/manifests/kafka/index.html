



<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
        <link rel="canonical" href="https://docs.prometheus.cool/logging/manifests/kafka/">
      
      
      
        <meta name="lang:clipboard.copy" content="复制">
      
        <meta name="lang:clipboard.copied" content="已复制">
      
        <meta name="lang:search.language" content="jp">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="没有找到符合条件的结果">
      
        <meta name="lang:search.result.one" content="找到 1 个符合条件的结果">
      
        <meta name="lang:search.result.other" content="# 个符合条件的结果">
      
        <meta name="lang:search.tokenizer" content="[\uff0c\u3002]+">
      
      <link rel="shortcut icon" href="../../../assets/img/prometheus_logo.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.0.2">
    
    
      
        <title>云原生监控神器Prometheus</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/application.982221ab.css">
      
        <link rel="stylesheet" href="../../../assets/stylesheets/application-palette.224b79ff.css">
      
      
        
        
        <meta name="theme-color" content="#ef5350">
      
    
    
      <script src="../../../assets/javascripts/modernizr.1f0bcf2b.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:300,400,400i,700|Ubuntu+Mono">
        <style>body,input{font-family:"Ubuntu","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Ubuntu Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../../../assets/styles/extra.css">
    
      <link rel="stylesheet" href="../../../assets/styles/prism.css">
    
    
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="red" data-md-color-accent="red">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#apache-kafka-helm-chart" tabindex="1" class="md-skip">
        跳转至
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://docs.prometheus.cool" title="云原生监控神器Prometheus" class="md-header-nav__button md-logo">
          
            <img src="../../../assets/img/prometheus_logo.png" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              云原生监控神器Prometheus
            </span>
            <span class="md-header-nav__topic">
              Apache Kafka Helm Chart
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            键入以开始搜索
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/k8stech/" title="前往 Github 仓库" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    GitHub
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="https://docs.prometheus.cool" title="云原生监控神器Prometheus" class="md-nav__button md-logo">
      
        <img src="../../../assets/img/prometheus_logo.png" width="48" height="48">
      
    </a>
    云原生监控神器Prometheus
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/k8stech/" title="前往 Github 仓库" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../../.." title="介绍" class="md-nav__link">
      介绍
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      监控基础与概述
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        监控基础与概述
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../monitorbasic/whymonitor/" title="为什么要监控" class="md-nav__link">
      为什么要监控
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../monitorbasic/monitorterms/" title="监控术语" class="md-nav__link">
      监控术语
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../monitorbasic/metricstory/" title="指标物语" class="md-nav__link">
      指标物语
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../monitorbasic/monitorcontrast/" title="开源监控对比" class="md-nav__link">
      开源监控对比
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Prometheus 基础
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Prometheus 基础
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../basic/prom-introduction/" title="Prometheus介绍" class="md-nav__link">
      Prometheus介绍
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../basic/tsdb-contrast/" title="时序数据库对比" class="md-nav__link">
      时序数据库对比
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../basic/prom-datamodel/" title="数据模型" class="md-nav__link">
      数据模型
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../basic/node-exporter/" title="Node_Exporter" class="md-nav__link">
      Node_Exporter
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../basic/prom-config/" title="Prometheus安装与配置" class="md-nav__link">
      Prometheus安装与配置
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Prometheus 进阶
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Prometheus 进阶
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../advanced/auto-ops-exporter-1/" title="自动化维护Exporter（一）" class="md-nav__link">
      自动化维护Exporter（一）
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../advanced/auto-ops-exporter-2/" title="自动化维护Exporter（二）" class="md-nav__link">
      自动化维护Exporter（二）
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../advanced/docker-swarm-monitor-1/" title="Docker-Swarm集群监控（一）" class="md-nav__link">
      Docker-Swarm集群监控（一）
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../advanced/docker-swarm-monitor-2/" title="Docker-Swarm集群监控（二）" class="md-nav__link">
      Docker-Swarm集群监控（二）
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../advanced/commonly-exporter/" title="常用Exporter介绍与配置" class="md-nav__link">
      常用Exporter介绍与配置
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Prometheus(警报)
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Prometheus(警报)
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../Alertmanager/promql-basic/" title="PromQL详解（一）" class="md-nav__link">
      PromQL详解（一）
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../Alertmanager/promql-operator/" title="PromQL详解（二）" class="md-nav__link">
      PromQL详解（二）
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../Alertmanager/promql-operator2/" title="PromQL详解（三）" class="md-nav__link">
      PromQL详解（三）
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../Alertmanager/promql-function/" title="PromQL函数" class="md-nav__link">
      PromQL函数
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../Alertmanager/alertmanager-overview/" title="AlertManager" class="md-nav__link">
      AlertManager
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../Alertmanager/alertmanager-rules-1/" title="Rules详解（一）" class="md-nav__link">
      Rules详解（一）
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../Alertmanager/alertmanager-rules-2/" title="Rules详解（二）" class="md-nav__link">
      Rules详解（二）
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../Alertmanager/alertmanager-receiver/" title="Receiver配置" class="md-nav__link">
      Receiver配置
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../Alertmanager/alertmanager-silences/" title="Silences配置" class="md-nav__link">
      Silences配置
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Prometheus(联邦集群)
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Prometheus(联邦集群)
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../federation/federation-overview/" title="Prometheus 联邦集群" class="md-nav__link">
      Prometheus 联邦集群
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../federation/pushgateway/" title="Pushgateway 代理" class="md-nav__link">
      Pushgateway 代理
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../federation/alertmanager-ha/" title="Alertmanager 高可用" class="md-nav__link">
      Alertmanager 高可用
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      Prometheus(服务发现)
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        Prometheus(服务发现)
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../discover-service/discovery-overview/" title="服务发现（文件、DNS）" class="md-nav__link">
      服务发现（文件、DNS）
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../discover-service/discovery-relabeling/" title="服务发现（Relabelling）" class="md-nav__link">
      服务发现（Relabelling）
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../discover-service/discovery-consul/" title="服务发现（Consul）" class="md-nav__link">
      服务发现（Consul）
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8">
    
    <label class="md-nav__link" for="nav-8">
      Prometheus(Operator)
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-8">
        Prometheus(Operator)
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../Kubernetes/Prometheus-Operator/" title="Operator概述" class="md-nav__link">
      Operator概述
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../Kubernetes/Prometheus-Statefulsets-1/" title="手动部署（1）" class="md-nav__link">
      手动部署（1）
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../Kubernetes/Prometheus-Statefulsets-2/" title="手动部署（2）" class="md-nav__link">
      手动部署（2）
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../Kubernetes/Prometheus-Statefulsets-3/" title="手动部署（联邦）" class="md-nav__link">
      手动部署（联邦）
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">目录</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#pre-requisites" title="Pre Requisites:" class="md-nav__link">
    Pre Requisites:
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#statefulset-details" title="StatefulSet Details" class="md-nav__link">
    StatefulSet Details
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#statefulset-caveats" title="StatefulSet Caveats" class="md-nav__link">
    StatefulSet Caveats
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chart-details" title="Chart Details" class="md-nav__link">
    Chart Details
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#installing-the-chart" title="Installing the Chart" class="md-nav__link">
    Installing the Chart
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#connecting-to-kafka-from-inside-kubernetes" title="Connecting to Kafka from inside Kubernetes" class="md-nav__link">
    Connecting to Kafka from inside Kubernetes
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#extensions" title="Extensions" class="md-nav__link">
    Extensions
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#connecting-to-kafka-from-outside-kubernetes" title="Connecting to Kafka from outside Kubernetes" class="md-nav__link">
    Connecting to Kafka from outside Kubernetes
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#nodeport-external-service-type" title="NodePort External Service Type" class="md-nav__link">
    NodePort External Service Type
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example-valuesyml-for-external-service-type-nodeport" title="Example values.yml for external service type NodePort" class="md-nav__link">
    Example values.yml for external service type NodePort
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#loadbalancer-external-service-type" title="LoadBalancer External Service Type" class="md-nav__link">
    LoadBalancer External Service Type
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example-valuesyml-and-dns-setup-for-external-service-type-loadbalancer-with-externaldistinct-true" title="Example values.yml and DNS setup for external service type LoadBalancer with external.distinct: true" class="md-nav__link">
    Example values.yml and DNS setup for external service type LoadBalancer with external.distinct: true
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-valuesyml-and-dns-setup-for-external-service-type-loadbalancer-with-externaldistinct-false" title="Example values.yml and DNS setup for external service type LoadBalancer with external.distinct: false" class="md-nav__link">
    Example values.yml and DNS setup for external service type LoadBalancer with external.distinct: false
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#known-limitations" title="Known Limitations" class="md-nav__link">
    Known Limitations
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prometheus-stats" title="Prometheus Stats" class="md-nav__link">
    Prometheus Stats
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prometheus-vs-prometheus-operator" title="Prometheus vs Prometheus Operator" class="md-nav__link">
    Prometheus vs Prometheus Operator
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jmx-exporter" title="JMX Exporter" class="md-nav__link">
    JMX Exporter
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kafka-exporter" title="Kafka Exporter" class="md-nav__link">
    Kafka Exporter
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/k8stech/edit/master/docs/logging/manifests/kafka/README.md" title="编辑此页" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="apache-kafka-helm-chart">Apache Kafka Helm Chart<a class="headerlink" href="#apache-kafka-helm-chart" title="Permanent link">&para;</a></h1>
<p>This is an implementation of Kafka StatefulSet found here:</p>
<ul>
<li>https://github.com/Yolean/kubernetes-kafka</li>
</ul>
<h2 id="pre-requisites">Pre Requisites:<a class="headerlink" href="#pre-requisites" title="Permanent link">&para;</a></h2>
<ul>
<li>
<p>Kubernetes 1.3 with alpha APIs enabled and support for storage classes</p>
</li>
<li>
<p>PV support on underlying infrastructure</p>
</li>
<li>
<p>Requires at least <code>v2.0.0-beta.1</code> version of helm to support
  dependency management with requirements.yaml</p>
</li>
</ul>
<h2 id="statefulset-details">StatefulSet Details<a class="headerlink" href="#statefulset-details" title="Permanent link">&para;</a></h2>
<ul>
<li>https://kubernetes.io/docs/concepts/workloads/controllers/statefulset/</li>
</ul>
<h2 id="statefulset-caveats">StatefulSet Caveats<a class="headerlink" href="#statefulset-caveats" title="Permanent link">&para;</a></h2>
<ul>
<li>https://kubernetes.io/docs/concepts/workloads/controllers/statefulset/#limitations</li>
</ul>
<h2 id="chart-details">Chart Details<a class="headerlink" href="#chart-details" title="Permanent link">&para;</a></h2>
<p>This chart will do the following:</p>
<ul>
<li>
<p>Implement a dynamically scalable kafka cluster using Kubernetes StatefulSets</p>
</li>
<li>
<p>Implement a dynamically scalable zookeeper cluster as another Kubernetes StatefulSet required for the Kafka cluster above</p>
</li>
<li>
<p>Expose Kafka protocol endpoints via NodePort services (optional)</p>
</li>
</ul>
<h3 id="installing-the-chart">Installing the Chart<a class="headerlink" href="#installing-the-chart" title="Permanent link">&para;</a></h3>
<p>To install the chart with the release name <code>my-kafka</code> in the default
namespace:</p>
<pre class="highlight"><code>$ helm repo add incubator http://storage.googleapis.com/kubernetes-charts-incubator
$ helm install --name my-kafka incubator/kafka</code></pre>

<p>If using a dedicated namespace(recommended) then make sure the namespace
exists with:</p>
<pre class="highlight"><code>$ helm repo add incubator http://storage.googleapis.com/kubernetes-charts-incubator
$ kubectl create ns kafka
$ helm install --name my-kafka --namespace kafka incubator/kafka</code></pre>

<p>This chart includes a ZooKeeper chart as a dependency to the Kafka
cluster in its <code>requirement.yaml</code> by default. The chart can be customized using the
following configurable parameters:</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>image</code></td>
<td>Kafka Container image name</td>
<td><code>confluentinc/cp-kafka</code></td>
</tr>
<tr>
<td><code>imageTag</code></td>
<td>Kafka Container image tag</td>
<td><code>5.0.1</code></td>
</tr>
<tr>
<td><code>imagePullPolicy</code></td>
<td>Kafka Container pull policy</td>
<td><code>IfNotPresent</code></td>
</tr>
<tr>
<td><code>replicas</code></td>
<td>Kafka Brokers</td>
<td><code>3</code></td>
</tr>
<tr>
<td><code>component</code></td>
<td>Kafka k8s selector key</td>
<td><code>kafka</code></td>
</tr>
<tr>
<td><code>resources</code></td>
<td>Kafka resource requests and limits</td>
<td><code>{}</code></td>
</tr>
<tr>
<td><code>securityContext</code></td>
<td>Kafka containers security context</td>
<td><code>{}</code></td>
</tr>
<tr>
<td><code>kafkaHeapOptions</code></td>
<td>Kafka broker JVM heap options</td>
<td><code>-Xmx1G-Xms1G</code></td>
</tr>
<tr>
<td><code>logSubPath</code></td>
<td>Subpath under <code>persistence.mountPath</code> where kafka logs will be placed.</td>
<td><code>logs</code></td>
</tr>
<tr>
<td><code>schedulerName</code></td>
<td>Name of Kubernetes scheduler (other than the default)</td>
<td><code>nil</code></td>
</tr>
<tr>
<td><code>serviceAccountName</code></td>
<td>Name of Kubernetes serviceAccount.  Useful when needing to pull images from custom repositories</td>
<td><code>nil</code></td>
</tr>
<tr>
<td><code>priorityClassName</code></td>
<td>Name of Kubernetes Pod PriorityClass. https://kubernetes.io/docs/concepts/configuration/pod-priority-preemption/#priorityclass</td>
<td><code>nil</code></td>
</tr>
<tr>
<td><code>affinity</code></td>
<td>Defines affinities and anti-affinities for pods as defined in: https://kubernetes.io/docs/concepts/configuration/assign-pod-node/#affinity-and-anti-affinity preferences</td>
<td><code>{}</code></td>
</tr>
<tr>
<td><code>tolerations</code></td>
<td>List of node tolerations for the pods. https://kubernetes.io/docs/concepts/configuration/taint-and-toleration/</td>
<td><code>[]</code></td>
</tr>
<tr>
<td><code>headless.annotations</code></td>
<td>List of annotations for the headless service. https://kubernetes.io/docs/concepts/services-networking/service/#headless-services</td>
<td><code>[]</code></td>
</tr>
<tr>
<td><code>headless.targetPort</code></td>
<td>Target port to be used for the headless service. This is not a required value.</td>
<td><code>nil</code></td>
</tr>
<tr>
<td><code>headless.port</code></td>
<td>Port to be used for the headless service. https://kubernetes.io/docs/concepts/configuration/taint-and-toleration/</td>
<td><code>9092</code></td>
</tr>
<tr>
<td><code>external.enabled</code></td>
<td>If True, exposes Kafka brokers via NodePort (PLAINTEXT by default)</td>
<td><code>false</code></td>
</tr>
<tr>
<td><code>external.dns.useInternal</code></td>
<td>If True, add Annotation for internal DNS service</td>
<td><code>false</code></td>
</tr>
<tr>
<td><code>external.dns.useExternal</code></td>
<td>If True, add Annotation for external DNS service</td>
<td><code>true</code></td>
</tr>
<tr>
<td><code>external.servicePort</code></td>
<td>TCP port configured at external services (one per pod) to relay from NodePort to the external listener port.</td>
<td>'19092'</td>
</tr>
<tr>
<td><code>external.firstListenerPort</code></td>
<td>TCP port which is added pod index number to arrive at the port used for NodePort and external listener port.</td>
<td>'31090'</td>
</tr>
<tr>
<td><code>external.domain</code></td>
<td>Domain in which to advertise Kafka external listeners.</td>
<td><code>cluster.local</code></td>
</tr>
<tr>
<td><code>external.type</code></td>
<td>Service Type.</td>
<td><code>NodePort</code></td>
</tr>
<tr>
<td><code>external.distinct</code></td>
<td>Distinct DNS entries for each created A record.</td>
<td><code>false</code></td>
</tr>
<tr>
<td><code>external.annotations</code></td>
<td>Additional annotations for the external service.</td>
<td><code>{}</code></td>
</tr>
<tr>
<td><code>external.loadBalancerIP</code></td>
<td>Add Static IP to the type Load Balancer. Depends on the provider if enabled</td>
<td><code>[]</code></td>
</tr>
<tr>
<td><code>external.loadBalancerSourceRanges</code></td>
<td>Add IP ranges that are allowed to access the Load Balancer.</td>
<td><code>[]</code></td>
</tr>
<tr>
<td><code>podAnnotations</code></td>
<td>Annotation to be added to Kafka pods</td>
<td><code>{}</code></td>
</tr>
<tr>
<td><code>podLabels</code></td>
<td>Labels to be added to Kafka pods</td>
<td><code>{}</code></td>
</tr>
<tr>
<td><code>podDisruptionBudget</code></td>
<td>Define a Disruption Budget for the Kafka Pods</td>
<td><code>{}</code></td>
</tr>
<tr>
<td><code>envOverrides</code></td>
<td>Add additional Environment Variables in the dictionary format</td>
<td><code>{ zookeeper.sasl.enabled: "False" }</code></td>
</tr>
<tr>
<td><code>configurationOverrides</code></td>
<td><code>Kafka</code> <a href="https://kafka.apache.org/documentation/#brokerconfigs">configuration setting</a> overrides in the dictionary format</td>
<td><code>{ "confluent.support.metrics.enable": false }</code></td>
</tr>
<tr>
<td><code>secrets</code></td>
<td>Pass any secrets to the kafka pods. Each secret will be passed as an environment variable by default. The secret can also be mounted to a specific path if required. Environment variable names are generated as: <code>&lt;secretName&gt;_&lt;secretKey&gt;</code> (All upper case)</td>
<td><code>{}</code></td>
</tr>
<tr>
<td><code>additionalPorts</code></td>
<td>Additional ports to expose on brokers.  Useful when the image exposes metrics (like prometheus, etc.) through a javaagent instead of a sidecar</td>
<td><code>{}</code></td>
</tr>
<tr>
<td><code>readinessProbe.initialDelaySeconds</code></td>
<td>Number of seconds before probe is initiated.</td>
<td><code>30</code></td>
</tr>
<tr>
<td><code>readinessProbe.periodSeconds</code></td>
<td>How often (in seconds) to perform the probe.</td>
<td><code>10</code></td>
</tr>
<tr>
<td><code>readinessProbe.timeoutSeconds</code></td>
<td>Number of seconds after which the probe times out.</td>
<td><code>5</code></td>
</tr>
<tr>
<td><code>readinessProbe.successThreshold</code></td>
<td>Minimum consecutive successes for the probe to be considered successful after having failed.</td>
<td><code>1</code></td>
</tr>
<tr>
<td><code>readinessProbe.failureThreshold</code></td>
<td>After the probe fails this many times, pod will be marked Unready.</td>
<td><code>3</code></td>
</tr>
<tr>
<td><code>terminationGracePeriodSeconds</code></td>
<td>Wait up to this many seconds for a broker to shut down gracefully, after which it is killed</td>
<td><code>60</code></td>
</tr>
<tr>
<td><code>updateStrategy</code></td>
<td>StatefulSet update strategy to use.</td>
<td><code>{ type: "OnDelete" }</code></td>
</tr>
<tr>
<td><code>podManagementPolicy</code></td>
<td>Start and stop pods in Parallel or OrderedReady (one-by-one.)  Can not change after first release.</td>
<td><code>OrderedReady</code></td>
</tr>
<tr>
<td><code>persistence.enabled</code></td>
<td>Use a PVC to persist data</td>
<td><code>true</code></td>
</tr>
<tr>
<td><code>persistence.size</code></td>
<td>Size of data volume</td>
<td><code>1Gi</code></td>
</tr>
<tr>
<td><code>persistence.mountPath</code></td>
<td>Mount path of data volume</td>
<td><code>/opt/kafka/data</code></td>
</tr>
<tr>
<td><code>persistence.storageClass</code></td>
<td>Storage class of backing PVC</td>
<td><code>nil</code></td>
</tr>
<tr>
<td><code>jmx.configMap.enabled</code></td>
<td>Enable the default ConfigMap for JMX</td>
<td><code>true</code></td>
</tr>
<tr>
<td><code>jmx.configMap.overrideConfig</code></td>
<td>Allows config file to be generated by passing values to ConfigMap</td>
<td><code>{}</code></td>
</tr>
<tr>
<td><code>jmx.configMap.overrideName</code></td>
<td>Allows setting the name of the ConfigMap to be used</td>
<td><code>""</code></td>
</tr>
<tr>
<td><code>jmx.port</code></td>
<td>The jmx port which JMX style metrics are exposed (note: these are not scrapeable by Prometheus)</td>
<td><code>5555</code></td>
</tr>
<tr>
<td><code>jmx.whitelistObjectNames</code></td>
<td>Allows setting which JMX objects you want to expose to via JMX stats to JMX Exporter</td>
<td>(see <code>values.yaml</code>)</td>
</tr>
<tr>
<td><code>nodeSelector</code></td>
<td>Node labels for pod assignment</td>
<td><code>{}</code></td>
</tr>
<tr>
<td><code>prometheus.jmx.resources</code></td>
<td>Allows setting resource limits for jmx sidecar container</td>
<td><code>{}</code></td>
</tr>
<tr>
<td><code>prometheus.jmx.enabled</code></td>
<td>Whether or not to expose JMX metrics to Prometheus</td>
<td><code>false</code></td>
</tr>
<tr>
<td><code>prometheus.jmx.image</code></td>
<td>JMX Exporter container image</td>
<td><code>solsson/kafka-prometheus-jmx-exporter@sha256</code></td>
</tr>
<tr>
<td><code>prometheus.jmx.imageTag</code></td>
<td>JMX Exporter container image tag</td>
<td><code>a23062396cd5af1acdf76512632c20ea6be76885dfc20cd9ff40fb23846557e8</code></td>
</tr>
<tr>
<td><code>prometheus.jmx.interval</code></td>
<td>Interval that Prometheus scrapes JMX metrics when using Prometheus Operator</td>
<td><code>10s</code></td>
</tr>
<tr>
<td><code>prometheus.jmx.scrapeTimeout</code></td>
<td>Timeout that Prometheus scrapes JMX metrics when using Prometheus Operator</td>
<td><code>10s</code></td>
</tr>
<tr>
<td><code>prometheus.jmx.port</code></td>
<td>JMX Exporter Port which exposes metrics in Prometheus format for scraping</td>
<td><code>5556</code></td>
</tr>
<tr>
<td><code>prometheus.kafka.enabled</code></td>
<td>Whether or not to create a separate Kafka exporter</td>
<td><code>false</code></td>
</tr>
<tr>
<td><code>prometheus.kafka.image</code></td>
<td>Kafka Exporter container image</td>
<td><code>danielqsj/kafka-exporter</code></td>
</tr>
<tr>
<td><code>prometheus.kafka.imageTag</code></td>
<td>Kafka Exporter container image tag</td>
<td><code>v1.2.0</code></td>
</tr>
<tr>
<td><code>prometheus.kafka.interval</code></td>
<td>Interval that Prometheus scrapes Kafka metrics when using Prometheus Operator</td>
<td><code>10s</code></td>
</tr>
<tr>
<td><code>prometheus.kafka.scrapeTimeout</code></td>
<td>Timeout that Prometheus scrapes Kafka metrics when using Prometheus Operator</td>
<td><code>10s</code></td>
</tr>
<tr>
<td><code>prometheus.kafka.port</code></td>
<td>Kafka Exporter Port which exposes metrics in Prometheus format for scraping</td>
<td><code>9308</code></td>
</tr>
<tr>
<td><code>prometheus.kafka.resources</code></td>
<td>Allows setting resource limits for kafka-exporter pod</td>
<td><code>{}</code></td>
</tr>
<tr>
<td><code>prometheus.kafka.affinity</code></td>
<td>Defines affinities and anti-affinities for pods as defined in: https://kubernetes.io/docs/concepts/configuration/assign-pod-node/#affinity-and-anti-affinity preferences</td>
<td><code>{}</code></td>
</tr>
<tr>
<td><code>prometheus.kafka.tolerations</code></td>
<td>List of node tolerations for the pods. https://kubernetes.io/docs/concepts/configuration/taint-and-toleration/</td>
<td><code>[]</code></td>
</tr>
<tr>
<td><code>prometheus.operator.enabled</code></td>
<td>True if using the Prometheus Operator, False if not</td>
<td><code>false</code></td>
</tr>
<tr>
<td><code>prometheus.operator.serviceMonitor.namespace</code></td>
<td>Namespace in which to install the ServiceMonitor resource. Default to kube-prometheus install.</td>
<td><code>monitoring</code></td>
</tr>
<tr>
<td><code>prometheus.operator.serviceMonitor.releaseNamespace</code></td>
<td>Set namespace to release namespace. Default false</td>
<td><code>false</code></td>
</tr>
<tr>
<td><code>prometheus.operator.serviceMonitor.selector</code></td>
<td>Default to kube-prometheus install (CoreOS recommended), but should be set according to Prometheus install</td>
<td><code>{ prometheus: kube-prometheus }</code></td>
</tr>
<tr>
<td><code>prometheus.operator.prometheusRule.enabled</code></td>
<td>True to create a PrometheusRule resource for Prometheus Operator, False if not</td>
<td><code>false</code></td>
</tr>
<tr>
<td><code>prometheus.operator.prometheusRule.namespace</code></td>
<td>Namespace in which to install the PrometheusRule resource. Default to kube-prometheus install.</td>
<td><code>monitoring</code></td>
</tr>
<tr>
<td><code>prometheus.operator.prometheusRule.releaseNamespace</code></td>
<td>Set namespace to release namespace. Default false</td>
<td><code>false</code></td>
</tr>
<tr>
<td><code>prometheus.operator.prometheusRule.selector</code></td>
<td>Default to kube-prometheus install (CoreOS recommended), but should be set according to Prometheus install</td>
<td><code>{ prometheus: kube-prometheus }</code></td>
</tr>
<tr>
<td><code>prometheus.operator.prometheusRule.rules</code></td>
<td>Define the prometheus rules. See values file for examples</td>
<td><code>{}</code></td>
</tr>
<tr>
<td><code>configJob.backoffLimit</code></td>
<td>Number of retries before considering kafka-config job as failed</td>
<td><code>6</code></td>
</tr>
<tr>
<td><code>topics</code></td>
<td>List of topics to create &amp; configure. Can specify name, partitions, replicationFactor, reassignPartitions, config. See values.yaml</td>
<td><code>[]</code> (Empty list)</td>
</tr>
<tr>
<td><code>zookeeper.enabled</code></td>
<td>If True, installs Zookeeper Chart</td>
<td><code>true</code></td>
</tr>
<tr>
<td><code>zookeeper.resources</code></td>
<td>Zookeeper resource requests and limits</td>
<td><code>{}</code></td>
</tr>
<tr>
<td><code>zookeeper.env</code></td>
<td>Environmental variables provided to Zookeeper Zookeeper</td>
<td><code>{ZK_HEAP_SIZE: "1G"}</code></td>
</tr>
<tr>
<td><code>zookeeper.storage</code></td>
<td>Zookeeper Persistent volume size</td>
<td><code>2Gi</code></td>
</tr>
<tr>
<td><code>zookeeper.image.PullPolicy</code></td>
<td>Zookeeper Container pull policy</td>
<td><code>IfNotPresent</code></td>
</tr>
<tr>
<td><code>zookeeper.url</code></td>
<td>URL of Zookeeper Cluster (unneeded if installing Zookeeper Chart)</td>
<td><code>""</code></td>
</tr>
<tr>
<td><code>zookeeper.port</code></td>
<td>Port of Zookeeper Cluster</td>
<td><code>2181</code></td>
</tr>
<tr>
<td><code>zookeeper.affinity</code></td>
<td>Defines affinities and anti-affinities for pods as defined in: https://kubernetes.io/docs/concepts/configuration/assign-pod-node/#affinity-and-anti-affinity preferences</td>
<td><code>{}</code></td>
</tr>
<tr>
<td><code>zookeeper.nodeSelector</code></td>
<td>Node labels for pod assignment</td>
<td><code>{}</code></td>
</tr>
</tbody>
</table>
<p>Specify parameters using <code>--set key=value[,key=value]</code> argument to <code>helm install</code></p>
<p>Alternatively a YAML file that specifies the values for the parameters can be provided like this:</p>
<pre class="highlight"><code class="language-bash">$ helm install --name my-kafka -f values.yaml incubator/kafka</code></pre>

<h3 id="connecting-to-kafka-from-inside-kubernetes">Connecting to Kafka from inside Kubernetes<a class="headerlink" href="#connecting-to-kafka-from-inside-kubernetes" title="Permanent link">&para;</a></h3>
<p>You can connect to Kafka by running a simple pod in the K8s cluster like this with a configuration like this:</p>
<pre class="highlight"><code class="language-yaml">apiVersion: v1
kind: Pod
metadata:
  name: testclient
  namespace: kafka
spec:
  containers:
  - name: kafka
    image: solsson/kafka:0.11.0.0
    command:
      - sh
      - -c
      - "exec tail -f /dev/null"</code></pre>

<p>Once you have the testclient pod above running, you can list all kafka
topics with:</p>
<p><code>kubectl -n kafka exec -ti testclient -- ./bin/kafka-topics.sh --zookeeper
my-release-zookeeper:2181 --list</code></p>
<p>Where <code>my-release</code> is the name of your helm release.</p>
<h2 id="extensions">Extensions<a class="headerlink" href="#extensions" title="Permanent link">&para;</a></h2>
<p>Kafka has a rich ecosystem, with lots of tools. This sections is intended to compile all of those tools for which a corresponding Helm chart has already been created.</p>
<ul>
<li><a href="https://github.com/kubernetes/charts/tree/master/incubator/schema-registry">Schema-registry</a> -  A confluent project that provides a serving layer for your metadata. It provides a RESTful interface for storing and retrieving Avro schemas.</li>
</ul>
<h2 id="connecting-to-kafka-from-outside-kubernetes">Connecting to Kafka from outside Kubernetes<a class="headerlink" href="#connecting-to-kafka-from-outside-kubernetes" title="Permanent link">&para;</a></h2>
<h3 id="nodeport-external-service-type">NodePort External Service Type<a class="headerlink" href="#nodeport-external-service-type" title="Permanent link">&para;</a></h3>
<p>Review and optionally override to enable the example text concerned with external access in <code>values.yaml</code>.</p>
<p>Once configured, you should be able to reach Kafka via NodePorts, one per replica. In kops where private,
topology is enabled, this feature publishes an internal round-robin DNS record using the following naming
scheme. The external access feature of this chart was tested with kops on AWS using flannel networking.
If you wish to enable external access to Kafka running in kops, your security groups will likely need to
be adjusted to allow non-Kubernetes nodes (e.g. bastion) to access the Kafka external listener port range.</p>
<pre class="highlight"><code>{{ .Release.Name }}.{{ .Values.external.domain }}</code></pre>

<p>If <code>external.distinct</code> is set theses entries will be prefixed with the replica number or broker id.</p>
<pre class="highlight"><code>{{ .Release.Name }}-&lt;BROKER_ID&gt;.{{ .Values.external.domain }}</code></pre>

<p>Port numbers for external access used at container and NodePort are unique to each container in the StatefulSet.
Using the default <code>external.firstListenerPort</code> number with a <code>replicas</code> value of <code>3</code>, the following
container and NodePorts will be opened for external access: <code>31090</code>, <code>31091</code>, <code>31092</code>. All of these ports should
be reachable from any host to NodePorts are exposed because Kubernetes routes each NodePort from entry node
to pod/container listening on the same port (e.g. <code>31091</code>).</p>
<p>The <code>external.servicePort</code> at each external access service (one such service per pod) is a relay toward
the a <code>containerPort</code> with a number matching its respective <code>NodePort</code>. The range of NodePorts is set, but
should not actually listen, on all Kafka pods in the StatefulSet. As any given pod will listen only one
such port at a time, setting the range at every Kafka pod is a reasonably safe configuration.</p>
<h4 id="example-valuesyml-for-external-service-type-nodeport">Example values.yml for external service type NodePort<a class="headerlink" href="#example-valuesyml-for-external-service-type-nodeport" title="Permanent link">&para;</a></h4>
<p>The + lines are with the updated values.
<pre class="highlight"><code> external:
-  enabled: false
+  enabled: true
   # type can be either NodePort or LoadBalancer
   type: NodePort
   # annotations:
@@ -170,14 +170,14 @@ configurationOverrides:
   ##
   ## Setting "advertised.listeners" here appends to "PLAINTEXT://${POD_IP}:9092,", ensure you update the domain
   ## If external service type is Nodeport:
-  # "advertised.listeners": |-
-  #   EXTERNAL://kafka.cluster.local:$((31090 + ${KAFKA_BROKER_ID}))
+  "advertised.listeners": |-
+    EXTERNAL://kafka.cluster.local:$((31090 + ${KAFKA_BROKER_ID}))
   ## If external service type is LoadBalancer and distinct is true:
   # "advertised.listeners": |-
   #   EXTERNAL://kafka-$((${KAFKA_BROKER_ID})).cluster.local:19092
   ## If external service type is LoadBalancer and distinct is false:
   # "advertised.listeners": |-
   #   EXTERNAL://EXTERNAL://${LOAD_BALANCER_IP}:31090
   ## Uncomment to define the EXTERNAL Listener protocol
-  # "listener.security.protocol.map": |-
-  #   PLAINTEXT:PLAINTEXT,EXTERNAL:PLAINTEXT
+  "listener.security.protocol.map": |-
+    PLAINTEXT:PLAINTEXT,EXTERNAL:PLAINTEXT


$ kafkacat -b kafka.cluster.local:31090 -L
Metadata for all topics (from broker 0: kafka.cluster.local:31090/0):
 3 brokers:
  broker 2 at kafka.cluster.local:31092
  broker 1 at kafka.cluster.local:31091
  broker 0 at kafka.cluster.local:31090
 0 topics:

$ kafkacat -b kafka.cluster.local:31090 -P -t test1 -p 0
msg01 from external producer to topic test1

$ kafkacat -b kafka.cluster.local:31090 -C -t test1 -p 0
msg01 from external producer to topic test1</code></pre></p>
<h3 id="loadbalancer-external-service-type">LoadBalancer External Service Type<a class="headerlink" href="#loadbalancer-external-service-type" title="Permanent link">&para;</a></h3>
<p>The load balancer external service type differs from the node port type by routing to the <code>external.servicePort</code> specified in the service for each statefulset container (if <code>external.distinct</code> is set). If <code>external.distinct</code> is false, <code>external.servicePort</code> is unused and will be set to the sum of <code>external.firstListenerPort</code> and the replica number.  It is important to note that <code>external.firstListenerPort</code> does not have to be within the configured node port range for the cluster, however a node port will be allocated.</p>
<h4 id="example-valuesyml-and-dns-setup-for-external-service-type-loadbalancer-with-externaldistinct-true">Example values.yml and DNS setup for external service type LoadBalancer with external.distinct: true<a class="headerlink" href="#example-valuesyml-and-dns-setup-for-external-service-type-loadbalancer-with-externaldistinct-true" title="Permanent link">&para;</a></h4>
<p>The + lines are with the updated values.
<pre class="highlight"><code> external:
-  enabled: false
+  enabled: true
   # type can be either NodePort or LoadBalancer
-  type: NodePort
+  type: LoadBalancer
   # annotations:
   #  service.beta.kubernetes.io/openstack-internal-load-balancer: "true"
   dns:
@@ -138,10 +138,10 @@ external:
   # If using external service type LoadBalancer and external dns, set distinct to true below.
   # This creates an A record for each statefulset pod/broker. You should then map the
   # A record of the broker to the EXTERNAL IP given by the LoadBalancer in your DNS server.
-  distinct: false
+  distinct: true
   servicePort: 19092
   firstListenerPort: 31090
-  domain: cluster.local
+  domain: example.com
   loadBalancerIP: []
   init:
     image: "lwolf/kubectl_deployer"
@@ -173,11 +173,11 @@ configurationOverrides:
   # "advertised.listeners": |-
   #   EXTERNAL://kafka.cluster.local:$((31090 + ${KAFKA_BROKER_ID}))
   ## If external service type is LoadBalancer and distinct is true:
-  # "advertised.listeners": |-
-  #   EXTERNAL://kafka-$((${KAFKA_BROKER_ID})).cluster.local:19092
+  "advertised.listeners": |-
+    EXTERNAL://kafka-$((${KAFKA_BROKER_ID})).example.com:19092
   ## Uncomment to define the EXTERNAL Listener protocol
-  # "listener.security.protocol.map": |-
-  #   PLAINTEXT:PLAINTEXT,EXTERNAL:PLAINTEXT
+  "listener.security.protocol.map": |-
+    PLAINTEXT:PLAINTEXT,EXTERNAL:PLAINTEXT

$ kubectl -n kafka get svc
NAME                       TYPE           CLUSTER-IP      EXTERNAL-IP      PORT(S)                      AGE
kafka                      ClusterIP      10.39.241.217   &lt;none&gt;           9092/TCP                     2m39s
kafka-0-external           LoadBalancer   10.39.242.45    35.200.238.174   19092:30108/TCP              2m39s
kafka-1-external           LoadBalancer   10.39.241.90    35.244.44.162    19092:30582/TCP              2m39s
kafka-2-external           LoadBalancer   10.39.243.160   35.200.149.80    19092:30539/TCP              2m39s
kafka-headless             ClusterIP      None            &lt;none&gt;           9092/TCP                     2m39s
kafka-zookeeper            ClusterIP      10.39.249.70    &lt;none&gt;           2181/TCP                     2m39s
kafka-zookeeper-headless   ClusterIP      None            &lt;none&gt;           2181/TCP,3888/TCP,2888/TCP   2m39s

DNS A record entries:
kafka-0.example.com A record 35.200.238.174 TTL 60sec
kafka-1.example.com A record 35.244.44.162 TTL 60sec
kafka-2.example.com A record 35.200.149.80 TTL 60sec

$ ping kafka-0.example.com
PING kafka-0.example.com (35.200.238.174): 56 data bytes

$ kafkacat -b kafka-0.example.com:19092 -L
Metadata for all topics (from broker 0: kafka-0.example.com:19092/0):
 3 brokers:
  broker 2 at kafka-2.example.com:19092
  broker 1 at kafka-1.example.com:19092
  broker 0 at kafka-0.example.com:19092
 0 topics:

$ kafkacat -b kafka-0.example.com:19092 -P -t gkeTest -p 0
msg02 for topic gkeTest

$ kafkacat -b kafka-0.example.com:19092 -C -t gkeTest -p 0
msg02 for topic gkeTest</code></pre></p>
<h4 id="example-valuesyml-and-dns-setup-for-external-service-type-loadbalancer-with-externaldistinct-false">Example values.yml and DNS setup for external service type LoadBalancer with external.distinct: false<a class="headerlink" href="#example-valuesyml-and-dns-setup-for-external-service-type-loadbalancer-with-externaldistinct-false" title="Permanent link">&para;</a></h4>
<p>The + lines are with the updated values.
<pre class="highlight"><code> external:
-  enabled: false
+  enabled: true
   # type can be either NodePort or LoadBalancer
-  type: NodePort
+  type: LoadBalancer
   # annotations:
   #  service.beta.kubernetes.io/openstack-internal-load-balancer: "true"
   dns:
@@ -138,10 +138,10 @@ external:
   distinct: false
   servicePort: 19092
   firstListenerPort: 31090
   domain: cluster.local
   loadBalancerIP: [35.200.238.174,35.244.44.162,35.200.149.80]
   init:
     image: "lwolf/kubectl_deployer"
@@ -173,11 +173,11 @@ configurationOverrides:
   # "advertised.listeners": |-
   #   EXTERNAL://kafka.cluster.local:$((31090 + ${KAFKA_BROKER_ID}))
   ## If external service type is LoadBalancer and distinct is true:
-  # "advertised.listeners": |-
-  #   EXTERNAL://kafka-$((${KAFKA_BROKER_ID})).cluster.local:19092
+  "advertised.listeners": |-
+    EXTERNAL://${LOAD_BALANCER_IP}:31090
   ## Uncomment to define the EXTERNAL Listener protocol
-  # "listener.security.protocol.map": |-
-  #   PLAINTEXT:PLAINTEXT,EXTERNAL:PLAINTEXT
+  "listener.security.protocol.map": |-
+    PLAINTEXT:PLAINTEXT,EXTERNAL:PLAINTEXT

$ kubectl -n kafka get svc
NAME                       TYPE           CLUSTER-IP      EXTERNAL-IP      PORT(S)                      AGE
kafka                      ClusterIP      10.39.241.217   &lt;none&gt;           9092/TCP                     2m39s
kafka-0-external           LoadBalancer   10.39.242.45    35.200.238.174   31090:30108/TCP              2m39s
kafka-1-external           LoadBalancer   10.39.241.90    35.244.44.162    31090:30582/TCP              2m39s
kafka-2-external           LoadBalancer   10.39.243.160   35.200.149.80    31090:30539/TCP              2m39s
kafka-headless             ClusterIP      None            &lt;none&gt;           9092/TCP                     2m39s
kafka-zookeeper            ClusterIP      10.39.249.70    &lt;none&gt;           2181/TCP                     2m39s
kafka-zookeeper-headless   ClusterIP      None            &lt;none&gt;           2181/TCP,3888/TCP,2888/TCP   2m39s

$ kafkacat -b 35.200.238.174:31090 -L
Metadata for all topics (from broker 0: 35.200.238.174:31090/0):
 3 brokers:
  broker 2 at 35.200.149.80:31090
  broker 1 at 35.244.44.162:31090
  broker 0 at 35.200.238.174:31090
 0 topics:

$ kafkacat -b 35.200.238.174:31090 -P -t gkeTest -p 0
msg02 for topic gkeTest

$ kafkacat -b 35.200.238.174:31090 -C -t gkeTest -p 0
msg02 for topic gkeTest</code></pre></p>
<h2 id="known-limitations">Known Limitations<a class="headerlink" href="#known-limitations" title="Permanent link">&para;</a></h2>
<ul>
<li>Only supports storage options that have backends for persistent volume claims (tested mostly on AWS)</li>
<li>KAFKA_PORT will be created as an envvar and brokers will fail to start when there is a service named <code>kafka</code> in the same namespace. We work around this be unsetting that envvar <code>unset KAFKA_PORT</code>.</li>
</ul>
<h2 id="prometheus-stats">Prometheus Stats<a class="headerlink" href="#prometheus-stats" title="Permanent link">&para;</a></h2>
<h3 id="prometheus-vs-prometheus-operator">Prometheus vs Prometheus Operator<a class="headerlink" href="#prometheus-vs-prometheus-operator" title="Permanent link">&para;</a></h3>
<p>Standard Prometheus is the default monitoring option for this chart. This chart also supports the CoreOS Prometheus Operator,
which can provide additional functionality like automatically updating Prometheus and Alert Manager configuration. If you are
interested in installing the Prometheus Operator please see the <a href="https://github.com/coreos/prometheus-operator/tree/master/helm">CoreOS repository</a> for more information or
read through the <a href="https://coreos.com/blog/the-prometheus-operator.html">CoreOS blog post introducing the Prometheus Operator</a></p>
<h3 id="jmx-exporter">JMX Exporter<a class="headerlink" href="#jmx-exporter" title="Permanent link">&para;</a></h3>
<p>The majority of Kafka statistics are provided via JMX and are exposed via the <a href="https://github.com/prometheus/jmx_exporter">Prometheus JMX Exporter</a>.</p>
<p>The JMX Exporter is a general purpose prometheus provider which is intended for use with any Java application. Because of this, it produces a number of statistics which
may not be of interest. To help in reducing these statistics to their relevant components we have created a curated whitelist <code>whitelistObjectNames</code> for the JMX exporter.
This whitelist may be modified or removed via the values configuration.</p>
<p>To accommodate compatibility with the Prometheus metrics, this chart performs transformations of raw JMX metrics. For example, broker names and topics names are incorporated
into the metric name instead of becoming a label. If you are curious to learn more about any default transformations to the chart metrics, please have reference the <a href="https://github.com/kubernetes/charts/blob/master/incubator/kafka/templates/jmx-configmap.yaml">configmap template</a>.</p>
<h3 id="kafka-exporter">Kafka Exporter<a class="headerlink" href="#kafka-exporter" title="Permanent link">&para;</a></h3>
<p>The <a href="https://github.com/danielqsj/kafka_exporter">Kafka Exporter</a> is a complementary metrics exporter to the JMX Exporter. The Kafka Exporter provides additional statistics on Kafka Consumer Groups.</p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      



<!-- Application footer -->
<footer class="md-footer">

    <!-- Further information -->
    <div class="md-footer-meta md-typeset">
        <div class="md-footer-meta__inner md-grid">

            <!-- Copyright and theme information -->
            <div class="md-footer-copyright">
                
                <div class="md-footer-copyright__highlight">
                    Copyright &copy; 2020 Kubernetes技术栈
                </div>
                
                powered by
                <a href="https://www.k8stech.net" title="Kubernetes技术栈">www.k8stech.net</a>
            </div>

            <!-- Social links -->
            
            
            
        </div>
    </div>
</footer>


    </div>
    
      <script src="../../../assets/javascripts/application.d9aa80ab.js"></script>
      
        
        
          
          <script src="../../../assets/javascripts/lunr/lunr.stemmer.support.js"></script>
          
            
              
                <script src="../../../assets/javascripts/lunr/tinyseg.js"></script>
              
              
                <script src="../../../assets/javascripts/lunr/lunr.jp.js"></script>
              
            
          
          
        
      
      <script>app.initialize({version:"1.0.4",url:{base:"../../.."}})</script>
      
        <script src="../../../assets/js/hljs/highlight.pack.js"></script>
      
        <script src="../../../assets/js/prism.js"></script>
      
    
  </body>
</html>